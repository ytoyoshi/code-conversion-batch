# 文字コード変換パターン一覧表

## ファイルタイプ別の変換パターン

### FILE_A / FILE_B

| 変換元文字コード | 変換先文字コード | 入力単位 | 出力単位 | 処理方式 | 備考 |
|----------------|----------------|---------|---------|---------|------|
| UTF-8 | JIS_X0201 | ファイル全体 | ファイル全体 | 一括変換 | 英数字・半角カナのみ |
| UTF-8 | CP930 | ファイル全体 | ファイル全体 | 一括変換 | 英数字・半角カナのみ |
| JIS_X0201 | UTF-8 | ファイル全体 | ファイル全体 | 一括変換 | - |
| JIS_X0201 | CP930 | ファイル全体 | ファイル全体 | 一括変換 | - |
| CP930 | UTF-8 | ファイル全体 | ファイル全体 | 一括変換 | - |
| CP930 | JIS_X0201 | ファイル全体 | ファイル全体 | 一括変換 | - |

**特徴**:
- レコード単位の処理なし
- ファイル全体を読み込んで一括変換
- 1バイト文字のみ対応

---

### FILE_C

| 変換元文字コード (1B/2B) | 変換先文字コード (1B/2B) | 入力レコード | 出力レコード | 処理方式 | 備考 |
|------------------------|------------------------|------------|------------|---------|------|
| UTF-8 / UTF-8 | JIS_X0201 / ISO-2022-JP | 380文字 | 380バイト | 部分変換 | 英数字・半角カナのみ |
| UTF-8 / UTF-8 | CP930 / CP930 | 380文字 | 380バイト | 部分変換 | 英数字・半角カナのみ |
| JIS_X0201 / ISO-2022-JP | UTF-8 / UTF-8 | 380バイト | 可変バイト | 部分変換 | - |
| JIS_X0201 / ISO-2022-JP | CP930 / CP930 | 380バイト | 380バイト | 部分変換 | - |
| CP930 / CP930 | UTF-8 / UTF-8 | 380バイト | 可変バイト | 部分変換 | - |
| CP930 / CP930 | JIS_X0201 / ISO-2022-JP | 380バイト | 380バイト | 部分変換 | - |

**レコード構成**:
1. ヘッダーレコード (1バイト目='1') ×1 → 全体を1バイト変換
2. データレコード (1バイト目='2') ×N → 漢字フィールドのみ2バイト変換
3. トレーラーレコード (1バイト目='8') ×1 → 全体を1バイト変換
4. エンドレコード (1バイト目='9') ×1 → 全体を1バイト変換

**漢字フィールド位置**:

*バイトベース (JIS/EBCDIC入力)*:
- 50-99バイト (25文字 = 50バイト)
- 150-199バイト (25文字 = 50バイト)
- 300-349バイト (25文字 = 50バイト)

*文字ベース (UTF-8入力)*:
- 50-74文字 (25文字)
- 150-174文字 (25文字)
- 300-324文字 (25文字)

---

### FILE_D

| 変換元文字コード (1B/2B) | 変換先文字コード (1B/2B) | 入力レコード | 出力レコード | 処理方式 | 備考 |
|------------------------|------------------------|------------|------------|---------|------|
| UTF-8 / UTF-8 | JIS_X0201 / ISO-2022-JP | 380文字 | 380バイト | 部分変換 | 英数字・半角カナのみ |
| UTF-8 / UTF-8 | CP930 / CP930 | 380文字 | 380バイト | 部分変換 | 英数字・半角カナのみ |
| JIS_X0201 / ISO-2022-JP | UTF-8 / UTF-8 | 380バイト | 可変バイト | 部分変換 | - |
| JIS_X0201 / ISO-2022-JP | CP930 / CP930 | 380バイト | 380バイト | 部分変換 | - |
| CP930 / CP930 | UTF-8 / UTF-8 | 380バイト | 可変バイト | 部分変換 | - |
| CP930 / CP930 | JIS_X0201 / ISO-2022-JP | 380バイト | 380バイト | 部分変換 | - |

**レコード構成**: FILE_Cと同じ

**漢字フィールド位置** (データ種別により変わる):

*バイトベース (JIS/EBCDIC入力)*:
- データ種別='1' (2バイト目=0x31):
  - 100-149バイト (25文字 = 50バイト)
  - 200-249バイト (25文字 = 50バイト)
- データ種別='2' (2バイト目=0x32):
  - 120-169バイト (25文字 = 50バイト)
  - 250-299バイト (25文字 = 50バイト)

*文字ベース (UTF-8入力)*:
- データ種別='1' (2文字目='1'):
  - 100-124文字 (25文字)
  - 200-224文字 (25文字)
- データ種別='2' (2文字目='2'):
  - 120-144文字 (25文字)
  - 250-274文字 (25文字)

---

### FILE_E / FILE_F

| 変換元文字コード | 変換先文字コード | 入力レコード | 出力レコード | 処理方式 | 備考 |
|----------------|----------------|------------|------------|---------|------|
| UTF-8 | JIS_X0201 | 可変長 | 可変長 | データ部分変換 | 制御文字変換: 0x74→0xB4 |
| UTF-8 | CP930 | 可変長 | 可変長 | データ部分変換 | 制御文字変換: 0x74→0xB4 |
| JIS_X0201 | UTF-8 | 可変長 | 可変長 | データ部分変換 | 制御文字変換: なし |
| JIS_X0201 | CP930 | 可変長 | 可変長 | データ部分変換 | 制御文字変換: なし |
| CP930 | UTF-8 | 可変長 | 可変長 | データ部分変換 | 制御文字変換: 0xB4→0x74 |
| CP930 | JIS_X0201 | 可変長 | 可変長 | データ部分変換 | 制御文字変換: 0xB4→0x74 |

**レコード構造**:
```
[0-3バイト] ブロック長 (4バイト、ビッグエンディアン)
[4-7バイト] レコード長 (4バイト、ビッグエンディアン)
[8バイト以降] データ部分 (変換対象)
```

**制御文字変換**:
- EBCDIC → JIS/UTF-8: 0xB4 → 0x74
- JIS/UTF-8 → EBCDIC: 0x74 → 0xB4

**特徴**:
- データ部分のみ変換
- 変換後の長さに応じてブロック長・レコード長を更新

---

## パラメータファイル設定例

### 例1: FILE_A (UTF-8 → JIS)

```properties
input.file.path=/data/input/file_a.txt
output.file.path=/data/output/file_a.dat
source.charset.single=UTF-8
source.charset.double=UTF-8
target.charset.single=JIS_X0201
target.charset.double=JIS_X0201
file.id=FILE_A
```

### 例2: FILE_C (UTF-8 → JIS混合)

```properties
input.file.path=/data/input/file_c.txt
output.file.path=/data/output/file_c.dat
source.charset.single=UTF-8
source.charset.double=UTF-8
target.charset.single=JIS_X0201
target.charset.double=ISO-2022-JP
file.id=FILE_C
```

### 例3: FILE_D (JIS混合 → EBCDIC)

```properties
input.file.path=/data/input/file_d.dat
output.file.path=/data/output/file_d.ebcdic
source.charset.single=JIS_X0201
source.charset.double=ISO-2022-JP
target.charset.single=CP930
target.charset.double=CP930
file.id=FILE_D
```

### 例4: FILE_E (EBCDIC → UTF-8)

```properties
input.file.path=/data/input/file_e.ebcdic
output.file.path=/data/output/file_e.txt
source.charset.single=CP930
source.charset.double=CP930
target.charset.single=UTF-8
target.charset.double=UTF-8
file.id=FILE_E
```

---

## 重要な注意事項

### UTF-8の制約

1. **FILE_A/B**: 
   - UTF-8ファイルには漢字が含まれない（英数字・半角カナのみ）

2. **FILE_C/D**:
   - UTF-8入力時: **380文字**で1レコード（バイト数は可変）
   - UTF-8ファイルには漢字が含まれない（英数字・半角カナのみ）
   - 文字数ベースでレコード読み込みとフィールド抽出を実施

3. **FILE_E/F**:
   - UTF-8は可変長のため、変換前後でレコード長が変わる可能性あり

### ISO-2022-JP (7bit JIS) の特殊処理

- 変換元がISO-2022-JPの場合: 入力データにESCシーケンスは含まれない想定
- 変換先がISO-2022-JPの場合: 出力データからESCシーケンスを除去
- ESCシーケンスの付与・除去は CodeConverter 内部で自動処理

### 制御文字変換 (FILE_E/F)

| 変換方向 | 変換元 | 変換先 |
|---------|-------|-------|
| EBCDIC → JIS/UTF-8 | 0xB4 (EBCDIC 'u') | 0x74 (JIS/UTF-8 't') |
| JIS/UTF-8 → EBCDIC | 0x74 (JIS/UTF-8 't') | 0xB4 (EBCDIC 'u') |

---

## サポートする文字コード

| 表記 | Charset名 | 説明 |
|-----|----------|------|
| UTF-8 | UTF-8 | Unicode (可変長: 1-4バイト) |
| JIS_X0201 | JIS_X0201 | JIS X 0201 (1バイト文字、半角カナ・英数字) |
| ISO-2022-JP | ISO-2022-JP | ISO-2022-JP (2バイト文字、7bit JIS、漢字) |
| CP930 | CP930 または IBM930 | EBCDIC (SBCS/DBCS混在) |

---

## 処理方式の違い

### ファイル全体一括変換 (FILE_A/B)

```
ファイル全体読み込み
  ↓
CodeConverter.convertCharset()
  ↓
ファイル全体出力
```

### レコード単位部分変換 (FILE_C/D)

```
1レコード読み込み
  ↓
レコード種別判定
  ├─ ヘッダー/トレーラー/エンド → 全体を1バイト変換
  └─ データ → フィールドごとに1バイト/2バイト変換
  ↓
1レコード出力
  ↓
次のレコードへ
```

### 可変長レコード変換 (FILE_E/F)

```
可変長レコード読み込み
  ↓
ブロック長・レコード長取得
  ↓
データ部分を変換(制御文字変換含む)
  ↓
新しいブロック長・レコード長計算
  ↓
可変長レコード出力
  ↓
次のレコードへ
```
